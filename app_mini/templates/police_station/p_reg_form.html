{% extends "guest/head_foot.html" %}
{% load widget_tweaks %}

{% block content %}
<br><br><br><br>
<div class="container_1 py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h2 class="h4 mb-0">Police Station Registration</h2>
                </div>
                <div class="card-body p-4">
                    <form method="post" class="needs-validation">
                        {% csrf_token %}
                        {% for field in p_reg_form %}
                            <div class="mb-3">
                                <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                                {{ field|add_class:"form-control" }}
                                {% if field.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ field.errors|join:", " }}
                                    </div>
                                {% endif %}
                            </div>
                        {% endfor %}

                        {% for field in log %}
                            <div class="mb-3">
                                <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                                {{ field|add_class:"form-control" }}
                                {% if field.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ field.errors|join:", " }}
                                    </div>
                                {% endif %}
                            </div>
                        {% endfor %}

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">Register Station</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .container_1 {
        background-color: #f8f9fa;
        padding: 2rem;
        border-radius: 15px;
    }
    .card {
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        border-radius: 10px;
        border: none;
        background-color: #ffffff;
    }
    .card-header {
        background-color: #061948 !important;
        border-radius: 10px 10px 0 0 !important;
    }
    .form-control:focus {
        border-color: #061948;
        box-shadow: 0 0 0 0.2rem rgba(6, 25, 72, 0.25);
    }
    .btn-primary {
        background-color: #061948;
        border-color: #061948;
    }
    .btn-primary:hover {
        background-color: #0a2666;
        border-color: #0a2666;
    }
</style>
<script>
        document.addEventListener('DOMContentLoaded', function () {
          const validators = [];
        
          // Reusable validation function
          function handleValidation(input, pattern, validMsg, invalidMsg) {
            const feedback = document.createElement('small');
            feedback.style.display = 'block';
            input.parentNode.appendChild(feedback);
        
            function validate() {
              const value = input.value.trim();
              if (!value) {
                feedback.textContent = '❌ This field is required';
                feedback.style.color = 'red';
                return false;
              } else if (!pattern.test(value)) {
                feedback.textContent = '❌ ' + invalidMsg;
                feedback.style.color = 'red';
                return false;
              } else {
                feedback.textContent = '✅ ' + validMsg;
                feedback.style.color = 'green';
                return true;
              }
            }
        
            input.addEventListener('input', validate);
            validators.push(validate);
          }
        
          // ✅ Name validation (letters and spaces only)
          const nameInput = document.querySelector('input[name="full_name"]');
          if (nameInput) {
            handleValidation(
              nameInput,
              /^[A-Za-z ]+$/,  // No limit on characters
              'Valid name',
              'Name must contain only letters and spaces'
            );
          }
        
          // ✅ Contact validation (10 digits)
          const contactInput = document.querySelector('input[name="contact"]');
          if (contactInput) {
            handleValidation(
              contactInput,
              /^\d{10}$/,
              'Valid phone number',
              'Enter a valid 10-digit phone number'
            );
          }
        
          // ✅ Email validation
          const emailInput = document.querySelector('input[name="email"]');
          if (emailInput) {
            handleValidation(
              emailInput,
              /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
              'Valid email address',
              'Enter a valid email address'
            );
          }
        
          // ✅ Password validation (min 8 chars, upper, lower, number, special char)
          const passwordInput = document.querySelector('input[name="password"]');
          if (passwordInput) {
            handleValidation(
              passwordInput,
              /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&]).{8,}$/,
              'Strong password',
              'Password must be at least 8 characters, include uppercase, lowercase, a number, and a special character'
            );
          }

          const adharInput = document.querySelector('input[name="adhar"]');
          if (adharInput) {
            handleValidation(
              adharInput,
              /^\d{12}$/,
              'Valid Aadhaar number',
              'Aadhaar number must be 12 digit'
            );
          }
        
          // Real-time "This field is required" for other fields
          const requiredFields = ['district', 'city', 'Village', 'Panchayat', 'Register_no', 'address_line_1', 'address_line_2', 'station_id', 'date_of_birth', 'gender', 'designation', 'staff_id'];
          requiredFields.forEach(fieldName => {
            const input = document.querySelector(`[name="${fieldName}"]`);
            if (input) {
              const feedback = document.createElement('small');
              feedback.style.display = 'block';
              input.parentNode.appendChild(feedback);
        
              input.addEventListener('input', function () {
                if (input.value.trim() === '') {
                  feedback.textContent = '❌ This field is required';
                  feedback.style.color = 'red';
                } else {
                  feedback.textContent = '';
                }
              });
            }
          });
        
          // Prevent form submission if any validation fails
          const form = document.querySelector('form');
          if (form) {
            form.addEventListener('submit', function (e) {
              let isValid = true;
              validators.forEach(validateFn => {
                if (!validateFn()) isValid = false;
              });
              if (!isValid) {
                e.preventDefault();
                alert("❌ Please fill all required fields and fix validation errors.");
              }
            });
          }
        });
        </script>
{% endblock %}